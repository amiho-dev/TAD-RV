<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAD.RV Teacher Dashboard</title>
    <!-- INLINE_CSS -->
</head>
<body>
    <!-- Announcement Banner (hidden by default) -->
    <div class="announcement-bar" id="announcementBar" style="display:none">
        <span class="announcement-icon">&#xE7AD;</span>
        <span id="announcementText">All screens frozen — Eyes on the teacher!</span>
        <button class="announcement-dismiss" onclick="dismissAnnouncement()">&#xE711;</button>
    </div>

    <!-- Header Stats Bar -->
    <div class="stats-bar">
        <div class="stats-left">
            <div class="stat">
                <span class="stat-value" id="statOnline">0</span>
                <span class="stat-label">Online</span>
            </div>
            <div class="stat">
                <span class="stat-value stat-locked" id="statLocked">0</span>
                <span class="stat-label">Locked</span>
            </div>
            <div class="stat">
                <span class="stat-value stat-frozen" id="statFrozen">0</span>
                <span class="stat-label">Frozen</span>
            </div>
            <div class="stat">
                <span class="stat-value stat-streaming" id="statStreaming">0</span>
                <span class="stat-label">Streaming</span>
            </div>
            <div class="stat">
                <span class="stat-value stat-hand" id="statHandRaised">0</span>
                <span class="stat-label">Hand Raised</span>
            </div>
            <div class="stat">
                <span class="stat-value stat-offline" id="statOffline">0</span>
                <span class="stat-label">Offline</span>
            </div>
        </div>
        <div class="stats-right">
            <div class="search-box">
                <span class="search-icon">&#xE721;</span>
                <input type="text" id="searchInput" placeholder="Search students..."
                       oninput="filterStudents(this.value)" />
            </div>
        </div>
    </div>

    <!-- Student Grid -->
    <div class="student-grid" id="studentGrid">
        <div class="empty-state" id="emptyState">
            <div class="empty-icon">&#xE7EF;</div>
            <h2>No Students Connected</h2>
            <p>Waiting for student endpoints to come online...</p>
            <p class="empty-hint" id="emptyHint"></p>
        </div>
    </div>

    <!-- Remote View Modal -->
    <div class="modal-overlay" id="rvModal" style="display:none">
        <div class="modal-content">
            <div class="modal-header">
                <span id="rvTitle">Remote View — Student</span>
                <div class="modal-actions">
                    <button class="modal-btn" onclick="toggleRvCensored()" title="Toggle Privacy Mode">
                        &#xE890;
                    </button>
                    <button class="modal-btn" onclick="freezeFromRv()" title="Freeze This Student">
                        &#xE7AD;
                    </button>
                    <button class="modal-btn danger" onclick="lockFromRv()" title="Lock This Student">
                        &#xE72E;
                    </button>
                    <button class="modal-btn" onclick="closeRv()">&#xE711;</button>
                </div>
            </div>
            <div class="modal-body">
                <canvas id="rvCanvas" width="1920" height="1080"></canvas>
            </div>
            <div class="modal-footer">
                <span id="rvStudentInfo"></span>
                <span id="rvStreamInfo">Sub-stream 480p</span>
            </div>
        </div>
    </div>

    <!-- Message Broadcast Dialog -->
    <div class="modal-overlay" id="messageModal" style="display:none">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <span>&#xE8BD; Broadcast Message</span>
                <button class="modal-btn" onclick="closeMessageDialog()">&#xE711;</button>
            </div>
            <div class="modal-body-form">
                <textarea id="messageText" placeholder="Type a message to send to all students..."
                          rows="4" maxlength="500"></textarea>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="sendBroadcastMessage()">
                        &#xE724; Send to All
                    </button>
                    <button class="btn btn-secondary" onclick="closeMessageDialog()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div class="modal-overlay" id="aboutModal" style="display:none" onclick="closeAbout(event)">
        <div class="modal-content modal-about">
            <div class="about-body">
                <div class="about-logo">&#xE71E;</div>
                <h1 class="about-title">TAD.RV</h1>
                <p class="about-subtitle">Teacher Controller</p>
                <p class="about-version" id="aboutVersion">v26700.192</p>
                <p class="about-branding">The Greater Brother of the mighty te.comp NET.FX</p>
                <div class="about-divider"></div>
                <p class="about-desc">Next-generation classroom management.<br/>
                   Real-time monitoring, screen capture, remote view,<br/>
                   and endpoint control for up to 50 students.</p>
                <div class="about-divider"></div>
                <p class="about-copyright">(C) 2026 TAD Europe — https://tad-it.eu</p>
                <div class="about-buttons">
                    <button class="btn btn-primary" onclick="showChangelog()">What's New</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('aboutModal').style.display='none'">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Changelog Modal -->
    <div class="modal-overlay" id="changelogModal" style="display:none" onclick="if(event.target===this)this.style.display='none'">
        <div class="modal-content modal-changelog">
            <div class="modal-header">
                <span>&#xE7C3; Update Log — TAD.RV</span>
                <button class="modal-btn" onclick="document.getElementById('changelogModal').style.display='none'">&#xE711;</button>
            </div>
            <div class="changelog-body">
                <div class="changelog-version">
                    <div class="changelog-badge current">v26700.192</div>
                    <span class="changelog-date">February 19, 2026 — Bugfix Release</span>
                </div>

                <div class="changelog-section">
                    <h3 class="changelog-section-title fix">Bug Fixes</h3>
                    <ul class="changelog-list">
                        <li>Fixed crash on startup ("Initializing WebView2") — deferred WebView2 init to the <code>Loaded</code> event so the window HWND exists before <code>EnsureCoreWebView2Async</code> is called</li>
                    </ul>
                </div>

                <div class="changelog-section">
                    <h3 class="changelog-section-title feature">New Features</h3>
                    <ul class="changelog-list">
                        <li>Kernel: PsSetCreateProcessNotifyRoutineEx — blocked application list enforced at process creation (IOCTL_TAD_SET_BANNED_APPS)</li>
                        <li>Teacher: "What\'s New?" link on update banner opens full release notes modal</li>
                        <li>Console: Scrollable release notes card visible when update is available</li>
                    </ul>
                </div>

                <div class="changelog-version">
                    <div class="changelog-badge">v26500.181</div>
                    <span class="changelog-date">February 18, 2026 — Update Release</span>
                </div>

                <div class="changelog-section">
                    <h3 class="changelog-section-title fix">Bug Fixes & Improvements</h3>
                    <ul class="changelog-list">
                        <li>Fixed auto-update repository configuration (default: amiho-dev/TAD-RV)</li>
                        <li>Added software update status to Admin Console dashboard</li>
                        <li>Verified ZIP packaging for update artifacts</li>
                        <li>Updated deployment documentation with auto-update configuration details</li>
                    </ul>
                </div>

                <div class="changelog-version">
                    <div class="changelog-badge">v26200.172</div>
                    <span class="changelog-date">February 17, 2026 — First Release</span>
                </div>

                <div class="changelog-section">
                    <h3 class="changelog-section-title fix">Bug Fixes</h3>
                    <ul class="changelog-list">
                        <li>Fixed WebView2 crash on startup — proper readiness gating before posting messages</li>
                        <li>Fixed WebMessage JSON case mismatch (JS camelCase → C# PascalCase deserialization)</li>
                        <li>Fixed double-encoding on postMessage → WebMessageAsJson path causing parse failures</li>
                        <li>Fixed demo frame overflow — added backpressure to prevent Dispatcher queue flooding</li>
                        <li>Fixed WebView2 user data folder permission errors on restricted machines</li>
                        <li>Fixed freeze/unfreeze command routing in production mode</li>
                    </ul>
                </div>

                <div class="changelog-section">
                    <h3 class="changelog-section-title feature">New Features</h3>
                    <ul class="changelog-list">
                        <li>System tray icon — minimize to tray with quick-access context menu (Lock All, Unlock All, Exit)</li>
                        <li>Auto-discovery — Teacher finds student clients automatically via UDP multicast (239.1.1.1:17421)</li>
                        <li>Synthetic demo desktops — 8 app-specific content renderers (Word, Code, Browser, Excel, PowerPoint, Paint, YouTube, Explorer)</li>
                        <li>Remote View modal with 1920×1080 canvas rendering</li>
                        <li>Broadcast messaging with in-dashboard dialog</li>
                        <li>Hand raise detection and visual indicator with pulse animation</li>
                        <li>Real-time search/filter across hostname, username, IP, and active window</li>
                        <li>Keyboard shortcuts: Esc to close modals, Ctrl+F to focus search</li>
                        <li>Version config pushed from C# to JS for About dialog</li>
                    </ul>
                </div>

                <div class="changelog-section">
                    <h3 class="changelog-section-title design">Design</h3>
                    <ul class="changelog-list">
                        <li>GitHub-dark inspired theme (#0D1117 / #161B22 / #58A6FF)</li>
                        <li>Smooth tile hover animations with elevation shadow</li>
                        <li>Per-student tile actions (RV, Lock, Unlock, Freeze) on hover</li>
                        <li>Status badges: Online, Locked, Frozen, Blank, Streaming, Hand Raised</li>
                        <li>Frozen overlay with blur backdrop on thumbnails</li>
                        <li>Privacy mode toggle (blur filter) in Remote View</li>
                        <li>Responsive grid layout with auto-fill columns</li>
                        <li>Branded splash screen with logo, version, and build date</li>
                    </ul>
                </div>

                <div class="changelog-section">
                    <h3 class="changelog-section-title infra">Infrastructure</h3>
                    <ul class="changelog-list">
                        <li>Self-contained demo builds — no .NET runtime required on target machines</li>
                        <li>Emulation mode — full stack without kernel driver or Active Directory</li>
                        <li>Separate client/teacher deployment folders for multi-machine demo</li>
                        <li>Linux cross-compilation support via EnableWindowsTargeting</li>
                        <li>Kernel driver: process protection, hard lock, UI protection, stealth mode IOCTLs</li>
                        <li>Binary wire protocol with length-prefixed framing (TadFrameCodec)</li>
                    </ul>
                </div>

                <div class="changelog-footer">
                    <p>(C) 2026 TAD Europe — https://tad-it.eu</p>
                    <p>TAD.RV — The Greater Brother of the mighty te.comp NET.FX</p>
                </div>
            </div>
        </div>
    </div>

    <!-- INLINE_JS -->
</body>
</html>
