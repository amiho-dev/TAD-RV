<UserControl x:Class="TadConsole.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:helpers="clr-namespace:TadConsole.Helpers"
             Background="{StaticResource PrimaryBrush}">

    <UserControl.Resources>
        <helpers:BoolToVisibilityConverter x:Key="BoolToVis" />
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="32,24">
        <StackPanel MaxWidth="960">

            <!-- ═══ Page Header ═══════════════════════════════════════════ -->
            <Grid Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Dashboard" FontSize="26" FontWeight="Bold"
                               Foreground="{StaticResource TextPrimaryBrush}" />
                    <TextBlock Text="Real-time status of TAD.RV components"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               FontSize="13" Margin="0,2,0,0" />
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="{Binding LastRefreshTime, StringFormat='Last update: {0}'}"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               FontSize="11" VerticalAlignment="Center" Margin="0,0,16,0" />
                    <Button Style="{StaticResource GhostButton}"
                            Command="{Binding RefreshCommand}"
                            Padding="12,7">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE72C;" FontFamily="Segoe MDL2 Assets"
                                           FontSize="12" VerticalAlignment="Center"
                                           Margin="0,0,6,0" />
                                <TextBlock Text="Refresh" FontFamily="{StaticResource PrimaryFont}"
                                           FontSize="12" VerticalAlignment="Center" />
                            </StackPanel>
                        </Button.Content>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- ═══ Status Cards Row ══════════════════════════════════════ -->
            <Grid Margin="0,0,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="12" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="12" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Driver Status Card -->
                <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,14">
                            <Border Width="36" Height="36" CornerRadius="8" Background="#0D2847"
                                    Margin="0,0,12,0">
                                <TextBlock Text="&#xE964;" FontFamily="Segoe MDL2 Assets"
                                           FontSize="16" Foreground="{StaticResource HighlightBrush}"
                                           HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Kernel Driver"
                                           FontSize="11" FontWeight="SemiBold"
                                           Foreground="{StaticResource TextSecondaryBrush}" />
                                <TextBlock Text="TAD.RV"
                                           FontSize="14" FontWeight="Bold"
                                           Foreground="{StaticResource TextPrimaryBrush}" />
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,14">
                            <Ellipse Width="10" Height="10" Margin="0,0,8,0">
                                <Ellipse.Fill>
                                    <SolidColorBrush Color="{Binding DriverStatusColor}" />
                                </Ellipse.Fill>
                            </Ellipse>
                            <TextBlock Text="{Binding DriverStatus}"
                                       FontSize="14" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}" />
                        </StackPanel>

                        <StackPanel Orientation="Horizontal">
                            <Button Style="{StaticResource SuccessButton}"
                                    Command="{Binding StartDriverCommand}"
                                    Padding="12,6" FontSize="11" Margin="0,0,6,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="&#xE768;" FontFamily="Segoe MDL2 Assets"
                                               FontSize="10" Margin="0,0,5,0" VerticalAlignment="Center" />
                                    <TextBlock Text="Start" />
                                </StackPanel>
                            </Button>
                            <Button Style="{StaticResource DangerButton}"
                                    Command="{Binding StopDriverCommand}"
                                    Padding="12,6" FontSize="11">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="&#xE71A;" FontFamily="Segoe MDL2 Assets"
                                               FontSize="10" Margin="0,0,5,0" VerticalAlignment="Center" />
                                    <TextBlock Text="Stop" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Service Status Card -->
                <Border Grid.Column="2" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,14">
                            <Border Width="36" Height="36" CornerRadius="8" Background="#0D2847"
                                    Margin="0,0,12,0">
                                <TextBlock Text="&#xE912;" FontFamily="Segoe MDL2 Assets"
                                           FontSize="16" Foreground="{StaticResource HighlightBrush}"
                                           HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Bridge Service"
                                           FontSize="11" FontWeight="SemiBold"
                                           Foreground="{StaticResource TextSecondaryBrush}" />
                                <TextBlock Text="TadBridgeService"
                                           FontSize="14" FontWeight="Bold"
                                           Foreground="{StaticResource TextPrimaryBrush}" />
                            </StackPanel>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <Ellipse Width="10" Height="10" Margin="0,0,8,0">
                                <Ellipse.Fill>
                                    <SolidColorBrush Color="{Binding ServiceStatusColor}" />
                                </Ellipse.Fill>
                            </Ellipse>
                            <TextBlock Text="{Binding ServiceStatus}"
                                       FontSize="14" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}" />
                        </StackPanel>

                        <TextBlock Text="{Binding ServicePid, StringFormat='PID: {0}'}"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontSize="11" Margin="0,0,0,10" />

                        <StackPanel Orientation="Horizontal">
                            <Button Style="{StaticResource SuccessButton}"
                                    Command="{Binding StartServiceCommand}"
                                    Padding="10,6" FontSize="11" Margin="0,0,6,0"
                                    Content="Start" />
                            <Button Style="{StaticResource DangerButton}"
                                    Command="{Binding StopServiceCommand}"
                                    Padding="10,6" FontSize="11" Margin="0,0,6,0"
                                    Content="Stop" />
                            <Button Style="{StaticResource PrimaryButton}"
                                    Command="{Binding RestartServiceCommand}"
                                    Padding="10,6" FontSize="11"
                                    Content="Restart" />
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- System Info Card -->
                <Border Grid.Column="4" Style="{StaticResource CardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,14">
                            <Border Width="36" Height="36" CornerRadius="8" Background="#0D2847"
                                    Margin="0,0,12,0">
                                <TextBlock Text="&#xE7F4;" FontFamily="Segoe MDL2 Assets"
                                           FontSize="16" Foreground="{StaticResource HighlightBrush}"
                                           HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="System Info"
                                           FontSize="11" FontWeight="SemiBold"
                                           Foreground="{StaticResource TextSecondaryBrush}" />
                                <TextBlock Text="{Binding Hostname}"
                                           FontSize="14" FontWeight="Bold"
                                           Foreground="{StaticResource TextPrimaryBrush}" />
                            </StackPanel>
                        </StackPanel>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                                <RowDefinition />
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Domain"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       FontSize="11" Margin="0,0,12,4" />
                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SystemDomain}"
                                       Foreground="{StaticResource TextPrimaryBrush}" FontSize="11"
                                       Margin="0,0,0,4" TextTrimming="CharacterEllipsis" />

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="User"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       FontSize="11" Margin="0,0,12,4" />
                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding CurrentUser}"
                                       Foreground="{StaticResource TextPrimaryBrush}" FontSize="11"
                                       Margin="0,0,0,4" TextTrimming="CharacterEllipsis" />

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Runtime"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       FontSize="11" Margin="0,0,12,4" />
                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding DotNetVersion}"
                                       Foreground="{StaticResource TextPrimaryBrush}" FontSize="11"
                                       Margin="0,0,0,4" />

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Uptime"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       FontSize="11" Margin="0,0,12,0" />
                            <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding SystemUptime}"
                                       Foreground="{StaticResource TextPrimaryBrush}" FontSize="11" />
                        </Grid>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- ═══ Health Checks ═════════════════════════════════════════ -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,14">
                        <TextBlock Text="&#xE9D5;" FontFamily="Segoe MDL2 Assets"
                                   FontSize="16" Foreground="{StaticResource HighlightBrush}"
                                   VerticalAlignment="Center" Margin="0,0,10,0" />
                        <TextBlock Text="Health Checks"
                                   FontSize="15" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimaryBrush}" />
                    </StackPanel>

                    <ItemsControl ItemsSource="{Binding HealthChecks}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="2" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#0D1117" CornerRadius="8"
                                        Padding="14,10" Margin="0,0,8,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <Ellipse Grid.Column="0" Width="8" Height="8"
                                                 Margin="0,0,10,0" VerticalAlignment="Center">
                                            <Ellipse.Fill>
                                                <SolidColorBrush Color="{Binding StatusColor}" />
                                            </Ellipse.Fill>
                                        </Ellipse>
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="{Binding Name}" FontSize="12"
                                                       FontWeight="SemiBold"
                                                       Foreground="{StaticResource TextPrimaryBrush}" />
                                            <TextBlock Text="{Binding Detail}" FontSize="10"
                                                       Foreground="{StaticResource TextSecondaryBrush}"
                                                       TextTrimming="CharacterEllipsis" />
                                        </StackPanel>
                                        <TextBlock Grid.Column="2" Text="{Binding Status}"
                                                   FontSize="11" FontWeight="SemiBold"
                                                   Foreground="{StaticResource TextSecondaryBrush}"
                                                   VerticalAlignment="Center" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

            <!-- ═══ Registry Configuration ════════════════════════════════ -->
            <Border Style="{StaticResource CardStyle}">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,14">
                        <TextBlock Text="&#xEDA2;" FontFamily="Segoe MDL2 Assets"
                                   FontSize="16" Foreground="{StaticResource HighlightBrush}"
                                   VerticalAlignment="Center" Margin="0,0,10,0" />
                        <TextBlock Text="Registry Configuration"
                                   FontSize="15" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   Margin="0,0,12,0" />

                        <Border CornerRadius="10" Padding="8,3">
                            <Border.Style>
                                <Style TargetType="Border" BasedOn="{StaticResource StatusBadge}">
                                    <Setter Property="Background" Value="#1A484F58" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding RegistryExists}" Value="True">
                                            <Setter Property="Background" Value="#1A3FB950" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <TextBlock FontSize="10" FontWeight="SemiBold">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="Not Found" />
                                        <Setter Property="Foreground"
                                                Value="{StaticResource TextSecondaryBrush}" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding RegistryExists}" Value="True">
                                                <Setter Property="Text" Value="Active" />
                                                <Setter Property="Foreground"
                                                        Value="{StaticResource SuccessBrush}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Border>
                    </StackPanel>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="170" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Install Directory"
                                   Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"
                                   Margin="0,0,0,8" />
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding InstallDir}"
                                   Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"
                                   Margin="0,0,0,8" />

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Domain Controller"
                                   Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"
                                   Margin="0,0,0,8" />
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding DomainController}"
                                   Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"
                                   Margin="0,0,0,8" />

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Deployed At"
                                   Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"
                                   Margin="0,0,0,8" />
                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding DeployedAt}"
                                   Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"
                                   Margin="0,0,0,8" />

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Provisioned"
                                   Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"
                                   Margin="0,0,0,8" />
                        <TextBlock Grid.Row="3" Grid.Column="1" Foreground="{StaticResource TextPrimaryBrush}"
                                   FontSize="12" Margin="0,0,0,8">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="No" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Provisioned}" Value="True">
                                            <Setter Property="Text" Value="Yes" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Organizational Unit"
                                   Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"
                                   Margin="0,0,0,8" />
                        <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding OrganizationalUnit}"
                                   Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"
                                   Margin="0,0,0,8" />

                        <TextBlock Grid.Row="5" Grid.Column="0" Text="Policy Version"
                                   Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"
                                   Margin="0,0,0,8" />
                        <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding PolicyVersion}"
                                   Foreground="{StaticResource TextPrimaryBrush}" FontSize="12"
                                   Margin="0,0,0,8" />
                    </Grid>
                </StackPanel>
            </Border>

        </StackPanel>
    </ScrollViewer>
</UserControl>
